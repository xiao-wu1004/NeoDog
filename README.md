# 基于STM32的新世代智能机器狗

#### 介绍
基于STM32F407IGH6的新世代智能狗（NeoDog），主要功能模块包括OLED显示、LED显示、WIFI控制、舵机模块（SG90）、ASRPRO语音模块、温湿度模块以及可扩展模块（包括但不仅限于红外线，蜂鸣器，马达，烟雾报警器等）；

#### 项目架构
项目总体架构说明
<img width="1199" height="1058" alt="image" src="https://github.com/user-attachments/assets/324dd838-17a6-4c9d-aff7-7c7800e92fcc" />

OLED模块：
    使用IIC协议与主控通信，能够显示温湿度信息以及走路、打招呼、左转、右转、跳舞等动作时的不同表情,提升项目交互性和可视化效果
    IIC协议：
        IIC（Inter-Integrated Circuit）是一种由飞利浦公司研发的两线制（SCL时钟线、SDA数据线）串行半双工同步通信协议，采用高位先行的数据传输方式；其硬件设计需在总线上连接上拉电阻，配置开漏输出以支持“线与”逻辑，允许多主机多从机架构，但同一时刻仅允许一个主机通过仲裁机制（低电平优先）控制总线；通信由主机发起，通过起始信号（SCL高时SDA下降沿）启动，停止信号（SCL高时SDA上升沿）终止，数据传输中时钟高电平阶段数据必须稳定，低电平时允许变化，并依靠应答信号（ACK）确认数据接收；标准速率涵盖100kb/s至5Mb/s，可通过硬件外设或软件模拟实现时序控制；（注意：IIC总线上必须接两个上拉电阻，用于总线空闲时将总线拉高；IO口需要设置为开漏输出）

LED模块：
    硬件为常用LED灯
    使用GPIO实现LED灯的亮灭，一般设置为推挽输出模式；
    GPIO的输入输出方式：输出有4种：具有上拉下拉功能的开漏输出，具有上拉下拉功能的推挽输出，具有上拉下拉功能的复用开漏，具有上拉下拉功能的复用推挽
                      输入有4种：上拉输入，浮空输入，下拉输入，模拟输入			
			
<img width="1747" height="738" alt="image" src="https://github.com/user-attachments/assets/5d1e2b94-9b82-475b-8f57-88474412b35e" />


温湿度模块：
    硬件为SHT20，SHT20 是 Sensirion 公司生产的一款高精度数字温湿度传感器，采用 I²C 通信，具有 ±0.3℃ 温度精度和 ±2%RH 湿度精度，支持低功耗模式，适用于智能家居、环境监测等应用；
    sht20流程：
        <img width="865" height="714" alt="image" src="https://github.com/user-attachments/assets/210f791a-890b-4497-ac9c-159fe9ee1408" />


    
IIC过程：
	1. 初始化
	GPIO配置：通过iic_init函数初始化GPIOB的PB6（SCL，时钟线）和PB7（SDA，数据线），将它们配置为开漏输出模式（GPIO_Mode_OUT，GPIO_OType_OD），时	钟频率为50MHz；
	无上下拉设置：GPIO未配置为上拉或下拉模式（GPIO_PuPd_NOPULL），以便通过外部上拉电阻实现IIC总线的拉高功能；
	2. 开始信号
	序号：1
	将SCL拉低，使总线占用，再将SDA设置为输出模式；
	将SDA拉高后，释放SCL线，等待5us时序稳定；
	将SDA拉低，产生一个下降沿，表示IIC通信开始；
	3. 停止信号
	序号：2
	将SCL拉低，使数据无效，再将SDA设置为输出模式；
	将SDA拉低后，释放SCL线，等待5us时序稳定；
	将SDA拉高，产生一个上升沿，表示IIC通信结束；
	4. 应答信号
	ACK（应答）：
	将SCL拉低，使数据无效，SDA设置为输出模式；
	将SDA拉低，产生一个低电平，作为应答信号；
	NACK（非应答）：
	将SCL拉低，使数据无效，SDA设置为输出模式；
	将SDA拉高，产生一个高电平，表示非应答；
	5. 等待应答
	序号：3
	将SDA设置为输入模式，等待从设备拉低SDA；
	如果SDA始终为高电平，超时返回NOACK；
	6. 发送数据
	序号：4
	将数据逐位发送到SDA线，通过8次循环完成1字节的传输；
	在每次发送时，SCL被短暂释放后拉低，确保每比特数据稳定；
	数据从高位到低位逐位发送；
	7. 读取数据
	序号：5
	将SDA设置为输入模式，从SDA线上读取1字节数据；
	每次读取1位数据后，拉高SCL，稳定后读取SDA上的电平；
	收到数据后，根据需求发送ACK或NACK信号；
	8. 整体流程
	使用iic_init初始化IIC总线；
	使用iic_start发送开始信号，启动一次通信；
	发送从设备地址（由用户实现）；
	根据IIC协议，发送命令字节（由用户实现）；
	使用iic_senddata发送数据到从设备，或使用iic_readdata从从设备读取数据；
	使用iic_stop发送停止信号，结束通信；

WIFI模块：
    硬件为ESP12F，通过串口3与主控进行通信，实现手机端连接WIFI模块，然后同过发送命令控制NeoDog的动作
    串口：**STM32 的串口（USART/UART）** 是一种通用同步/异步串行（LSB 优先）全双工通信接口，采用 **TX（发送）、RX（接收）、GND（共地）** 三线连接方式，设备间需交叉连接 TX 和 RX 以实现双向通信；它适用于 **短距离通信**，传输速率由 **波特率（如 9600、115200）** 决定，数据格式包括 **起始位（低电平）、8 位数据位、可选的奇偶校验位（验证数据正确性）和停止位（高电平）**；串口常用于 **设备间通信** 和 **调试信息输出**，支持奇偶校验（奇校验或偶校验）以提高数据可靠性；
    波特率：决定数据传输的速度，即每秒钟传输数据的bit数

舵机模块：
    硬件为SG90，通过初始化定时器，使用PWM（脉冲宽度调制），通过调整它的占空比来调节舵机的角度，以实现NeoDog的各种动作，比如前进，左转，右转，跳舞，打招呼，站立，趴下等动作
    舵机控制：
      舵机的控制一般需要一个20ms 左右的时基脉冲，该脉冲的高电平部分一般为0.5ms~2.5ms 范围内的角度控制脉冲部分；以180 度角度伺服为例，那么对应的控制关系是这样的：
      0.5ms ---------- 0 度；
      1.0ms ---------- 45 度；
      1.5ms ---------- 90 度；
      2.0ms ---------- 135 度；
      2.5ms ---------- 180 度；

ASRPRO语音模块：
    硬件如其名（ASRPRO），采用天问Block（无广）编写代码，通过编写代码，可以通过ASRPRO的串口0（实际有三个串口，可自行配置）发送指令给主控的串口2，然后串口2跟主控进行通信，接受到你天问Block编写的特定命令后，就可以用语音模块控制NeoDog的动作了，你还可以让语音模块唱歌以及其他的扩展功能

		



